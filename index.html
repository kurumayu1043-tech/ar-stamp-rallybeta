<!DOCTYPE html>
<HTML lung="JA">
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no">
    <title>AR Stamp Rally - Enhanced</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #000;
            overflow: hidden;
        }
        
        #arjs-video {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            object-fit: cover !important;
            z-index: -1 !important;
        }
        
        .a-canvas {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            z-index: 1 !important;
        }
        
        #ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 999;
            pointer-events: none;
        }
        
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            pointer-events: all;
        }
        
        #startButton {
            background: #4CAF50;
            border: none;
            color: white;
            padding: 20px 40px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 18px;
            margin: 20px 2px;
            cursor: pointer;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            touch-action: manipulation;
        }
        
        #info {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            text-align: center;
            pointer-events: none;
            border: 2px solid #4CAF50;
        }
        
        #stats {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: #00FF00;
            padding: 10px;
            border-radius: 5px;
            font-size: 11px;
            font-family: monospace;
            pointer-events: none;
            min-width: 200px;
            border: 1px solid #00FF00;
        }
        
        #debug {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: #FFD700;
            padding: 10px;
            border-radius: 5px;
            font-size: 11px;
            font-family: monospace;
            pointer-events: none;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #FFD700;
        }
        
        #marker-guide {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 250px;
            pointer-events: none;
            z-index: 100;
        }
        
        .corner {
            position: absolute;
            width: 40px;
            height: 40px;
            border: 3px solid #4CAF50;
        }
        
        .corner-tl {
            top: 0;
            left: 0;
            border-right: none;
            border-bottom: none;
        }
        
        .corner-tr {
            top: 0;
            right: 0;
            border-left: none;
            border-bottom: none;
        }
        
        .corner-bl {
            bottom: 0;
            left: 0;
            border-right: none;
            border-top: none;
        }
        
        .corner-br {
            bottom: 0;
            right: 0;
            border-left: none;
            border-top: none;
        }
        
        #marker-guide.detected {
            animation: pulse 0.5s;
        }
        
        #marker-guide.detected .corner {
            border-color: #00FF00;
            box-shadow: 0 0 10px #00FF00;
        }
        
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        #guide-text {
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            color: #4CAF50;
            font-size: 12px;
            background: rgba(0,0,0,0.9);
            padding: 5px 10px;
            border-radius: 5px;
            white-space: nowrap;
        }
        
        .hidden {
            display: none !important;
        }
        
        #confidence-bar {
            position: fixed;
            bottom: 180px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 20px;
            background: rgba(0,0,0,0.8);
            border: 1px solid #444;
            border-radius: 10px;
            overflow: hidden;
        }
        
        #confidence-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #FF0000, #FFD700, #00FF00);
            transition: width 0.3s ease;
        }
        
        #confidence-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="ui-overlay">
        <div id="loading">
            <h1>üéØ AR „Çπ„Çø„É≥„Éó„É©„É™„Éº</h1>
            <p id="status">„Çø„ÉÉ„Éó„Åó„Å¶ÈñãÂßã</p>
            <button id="startButton">üì∑ „Ç´„É°„É©„ÇíÈñãÂßã</button>
            <div style="margin-top: 20px; font-size: 14px; opacity: 0.8; max-width: 300px;">
                <p style="color: #FFD700;">üìå ÈáçË¶Å„Å™Ê∫ñÂÇôÔºö</p>
                <ul style="text-align: left; color: #CCC;">
                    <li>HIRO„Éû„Éº„Ç´„Éº„ÇíÂç∞Âà∑„Åæ„Åü„ÅØÁîªÈù¢Ë°®Á§∫</li>
                    <li>Êòé„Çã„ÅÑÂ†¥ÊâÄ„Åß‰ΩøÁî®</li>
                    <li>„Éû„Éº„Ç´„Éº„ÇíÂπ≥„Çâ„Å´ÁΩÆ„Åè</li>
                    <li>„Ç´„É°„É©„Åã„Çâ20-40cm„ÅÆË∑ùÈõ¢</li>
                </ul>
                <a href="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png" 
                   target="_blank" 
                   style="color: #4CAF50; text-decoration: none; display: inline-block; margin-top: 10px; padding: 8px 16px; border: 1px solid #4CAF50; border-radius: 5px;">
                    üì• HIRO„Éû„Éº„Ç´„Éº„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
                </a>
            </div>
        </div>
        
        <div id="info" class="hidden">
            <div id="info-text">AR„Ç´„É°„É©Ëµ∑Âãï‰∏≠...</div>
        </div>
        
        <div id="stats" class="hidden">
            <div style="color: white; font-weight: bold; margin-bottom: 5px;">üìä Ë™çË≠òÁä∂ÊÖã</div>
            <div id="stats-content">
                FPS: <span id="fps">0</span><br>
                Ê§úÂá∫Âº∑Â∫¶: <span id="detection">0</span>%<br>
                „Éû„Éº„Ç´„ÉºÁä∂ÊÖã: <span id="marker-status">Êé¢Á¥¢‰∏≠</span><br>
                „Ç´„É°„É©: <span id="camera-status">Ê∫ñÂÇô‰∏≠</span>
            </div>
        </div>
        
        <div id="marker-guide" class="hidden">
            <div id="guide-text">HIRO„Éû„Éº„Ç´„Éº„Çí„Åì„Åì„Å´Âêà„Çè„Åõ„Çã</div>
            <div class="corner corner-tl"></div>
            <div class="corner corner-tr"></div>
            <div class="corner corner-bl"></div>
            <div class="corner corner-br"></div>
        </div>
        
        <div id="confidence-bar" class="hidden">
            <div id="confidence-fill"></div>
            <div id="confidence-label">Ë™çË≠òÂº∑Â∫¶: 0%</div>
        </div>
        
        <div id="debug" class="hidden">
            <div id="debug-text">Debug info</div>
        </div>
    </div>

    <!-- ÊúÄÈÅ©Âåñ„Åï„Çå„ÅüAR Scene -->
    <a-scene
        id="arScene"
        embedded
        arjs="sourceType: webcam; 
              debugUIEnabled: false; 
              detectionMode: mono; 
              matrixCodeType: 3x3;
              trackingMethod: best;
              patternRatio: 0.5;
              labelingMode: black_region;
              processingMode: best;
              maxDetectionRate: 60;
              canvasWidth: 640;
              canvasHeight: 480;
              imageSmoothingEnabled: true;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false"
        renderer="logarithmicDepthBuffer: true; 
                  precision: high; 
                  antialias: true; 
                  alpha: true;
                  colorManagement: true;"
        stats>
        
        <!-- „Ç´„Çπ„Çø„É†„Ç´„É°„É©Ë®≠ÂÆö -->
        <a-camera-static/>
        
        <!-- ÊúÄÈÅ©Âåñ„Åï„Çå„ÅüHIRO„Éû„Éº„Ç´„Éº -->
        <a-marker
            preset="hiro"
            id="hiro-marker"
            smooth="true"
            smoothCount="10"
            smoothTolerance="0.01"
            smoothThreshold="5"
            size="1"
            type="pattern"
            url="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/data/patt.hiro">
            
            <!-- „É°„Ç§„É≥„ÅÆ„Çπ„Çø„É≥„Éó„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà -->
            <a-entity id="stamp-container" position="0 0 0">
                
                <!-- „Éô„Éº„Çπ„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É† -->
                <a-cylinder
                    position="0 0 0"
                    radius="1"
                    height="0.1"
                    color="#2C3E50"
                    shadow="receive: true">
                </a-cylinder>
                
                <!-- „É°„Ç§„É≥„Çπ„Çø„É≥„Éó -->
                <a-box
                    id="main-stamp"
                    position="0 0.5 0"
                    scale="0.6 0.6 0.6"
                    material="color: #FFD700; metalness: 0.3; roughness: 0.4"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 3000; easing: easeInOutQuad"
                    shadow>
                </a-box>
                
                <!-- Ë£ÖÈ£æ„É™„É≥„Ç∞1 -->
                <a-torus
                    position="0 0.5 0"
                    color="#FF6B6B"
                    radius="0.7"
                    radius-tubular="0.05"
                    animation="property: rotation; to: 360 0 0; loop: true; dur: 2000">
                </a-torus>
                
                <!-- Ë£ÖÈ£æ„É™„É≥„Ç∞2 -->
                <a-torus
                    position="0 0.5 0"
                    color="#4ECDC4"
                    radius="0.9"
                    radius-tubular="0.03"
                    animation="property: rotation; to: 0 360 360; loop: true; dur: 3000">
                </a-torus>
                
                <!-- „Çπ„Çø„É≥„Éó„ÉÜ„Ç≠„Çπ„Éà -->
                <a-text
                    value="STAMP GET!"
                    position="0 1.3 0"
                    align="center"
                    color="#FFFFFF"
                    font="kelsonsans"
                    width="4"
                    animation="property: scale; from: 1 1 1; to: 1.2 1.2 1.2; dir: alternate; loop: true; dur: 1000">
                </a-text>
                
                <!-- „Éë„Éº„ÉÜ„Ç£„ÇØ„É´ÂäπÊûú -->
                <a-entity
                    position="0 0.5 0"
                    particle-system="preset: star; 
                                   particleCount: 100; 
                                   color: #FFD700,#FF6B6B; 
                                   size: 0.5; 
                                   duration: 0.1;
                                   accelerationValue: 0,-5,0;
                                   velocityValue: 0,3,0">
                </a-entity>
                
            </a-entity>
            
        </a-marker>
        
        <a-entity camera></a-entity>
        
    </a-scene>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        const startButton = document.getElementById('startButton');
        const loading = document.getElementById('loading');
        const info = document.getElementById('info');
        const status = document.getElementById('status');
        const infoText = document.getElementById('info-text');
        const debug = document.getElementById('debug');
        const debugText = document.getElementById('debug-text');
        const stats = document.getElementById('stats');
        const markerGuide = document.getElementById('marker-guide');
        const confidenceBar = document.getElementById('confidence-bar');
        const confidenceFill = document.getElementById('confidence-fill');
        const confidenceLabel = document.getElementById('confidence-label');
        
        let debugLog = [];
        let markerDetected = false;
        let detectionConfidence = 0;
        let frameCount = 0;
        let lastTime = performance.now();
        let fps = 0;
        
        // „Éá„Éê„Ç§„ÇπÊ§úÂá∫
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const isAndroid = /Android/.test(navigator.userAgent);
        const isMobile = isIOS || isAndroid;
        
        // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞Èñ¢Êï∞
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : 'üìù';
            const logEntry = `${timestamp} ${icon} ${message}`;
            
            console.log(logEntry);
            debugLog.push(logEntry);
            if (debugLog.length > 8) debugLog.shift();
            
            debugText.innerHTML = debugLog.join('<br>');
            debug.classList.remove('hidden');
        }
        
        // FPSË®àÁÆó
        function updateFPS() {
            frameCount++;
            const currentTime = performance.now();
            if (currentTime >= lastTime + 1000) {
                fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                document.getElementById('fps').textContent = fps;
                frameCount = 0;
                lastTime = currentTime;
            }
            requestAnimationFrame(updateFPS);
        }
        
        // Ë™çË≠òÂº∑Â∫¶„ÅÆÊõ¥Êñ∞
        function updateConfidence(value) {
            detectionConfidence = Math.min(100, Math.max(0, value));
            confidenceFill.style.width = detectionConfidence + '%';
            confidenceLabel.textContent = `Ë™çË≠òÂº∑Â∫¶: ${Math.round(detectionConfidence)}%`;
            document.getElementById('detection').textContent = Math.round(detectionConfidence);
        }
        
        // „Ç´„É°„É©ÈñãÂßãÂá¶ÁêÜ
        startButton.addEventListener('click', async function() {
            log('„Ç´„É°„É©Ëµ∑ÂãïÈñãÂßã');
            status.textContent = "„Ç´„É°„É©„Å´„Ç¢„ÇØ„Çª„Çπ‰∏≠...";
            
            try {
                // „Ç´„É°„É©„Çπ„Éà„É™„Éº„É†„ÇíÂèñÂæó
                const constraints = {
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1280, max: 1920 },
                        height: { ideal: 720, max: 1080 },
                        frameRate: { ideal: 30, max: 60 }
                    }
                };
                
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                log('„Ç´„É°„É©„Ç¢„ÇØ„Çª„ÇπÊàêÂäü', 'success');
                
                // „Çπ„Éà„É™„Éº„É†ÊÉÖÂ†±„Çí„É≠„Ç∞
                const track = stream.getVideoTracks()[0];
                const settings = track.getSettings();
                log(`Ëß£ÂÉèÂ∫¶: ${settings.width}x${settings.height} @ ${settings.frameRate}fps`);
                
                // AR.js„Å´‰ªª„Åõ„Çã„Åü„ÇÅ„Çπ„Éà„É™„Éº„É†„ÇíÂÅúÊ≠¢
                stream.getTracks().forEach(track => track.stop());
                
                // UIÂàá„ÇäÊõø„Åà
                setTimeout(() => {
                    loading.classList.add('hidden');
                    info.classList.remove('hidden');
                    stats.classList.remove('hidden');
                    markerGuide.classList.remove('hidden');
                    confidenceBar.classList.remove('hidden');
                    
                    infoText.innerHTML = `
                        <div style="font-size: 16px; color: #4CAF50;">‚ú® AR„Ç´„É°„É©Ëµ∑ÂãïÂÆå‰∫Ü</div>
                        <div style="font-size: 12px; margin-top: 5px;">HIRO„Éû„Éº„Ç´„Éº„Çí„Ç¨„Ç§„ÉâÊû†ÂÜÖ„Å´ÈÖçÁΩÆ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                    `;
                    
                    document.getElementById('camera-status').textContent = 'Âãï‰Ωú‰∏≠';
                    document.getElementById('camera-status').style.color = '#00FF00';
                    
                    // AR.js„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
                    setupARListeners();
                    
                    // FPSË®àÊ∏¨ÈñãÂßã
                    updateFPS();
                    
                    // ÂÆöÊúüÁöÑ„Å™Áä∂ÊÖã„ÉÅ„Çß„ÉÉ„ÇØ
                    setInterval(checkARHealth, 2000);
                    
                }, isMobile ? 3000 : 2000);
                
            } catch (error) {
                log(`„Ç´„É°„É©„Ç®„É©„Éº: ${error.message}`, 'error');
                handleCameraError(error);
            }
        });
        
        // AR„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
        function setupARListeners() {
            const marker = document.getElementById('hiro-marker');
            const scene = document.querySelector('a-scene');
            
            if (!marker) {
                log('„Éû„Éº„Ç´„ÉºË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                return;
            }
            
            // „Éû„Éº„Ç´„ÉºÊ§úÂá∫„Ç§„Éô„É≥„Éà
            marker.addEventListener('markerFound', () => {
                if (!markerDetected) {
                    markerDetected = true;
                    log('HIRO„Éû„Éº„Ç´„ÉºÊ§úÂá∫ÔºÅ', 'success');
                    
                    markerGuide.classList.add('detected');
                    document.getElementById('marker-status').textContent = 'Ê§úÂá∫‰∏≠';
                    document.getElementById('marker-status').style.color = '#00FF00';
                    
                    infoText.innerHTML = `
                        <div style="font-size: 18px; color: #00FF00;">üéâ „Çπ„Çø„É≥„ÉóÁô∫Ë¶ãÔºÅ</div>
                        <div style="font-size: 12px; margin-top: 5px;">„Éû„Éº„Ç´„Éº„ÇíÂÆâÂÆö„Åï„Åõ„Å¶„Åè„Å†„Åï„ÅÑ</div>
                    `;
                    
                    info.style.borderColor = '#00FF00';
                    info.style.boxShadow = '0 0 20px #00FF00';
                    
                    // Ë™çË≠òÂº∑Â∫¶„ÇíÊÆµÈöéÁöÑ„Å´‰∏ä„Åí„Çã
                    let confidence = 0;
                    const increaseConfidence = setInterval(() => {
                        confidence += 10;
                        updateConfidence(confidence);
                        if (confidence >= 100) {
                            clearInterval(increaseConfidence);
                        }
                    }, 100);
                }
            });
            
            // „Éû„Éº„Ç´„Éº„É≠„Çπ„Éà„Ç§„Éô„É≥„Éà
            marker.addEventListener('markerLost', () => {
                if (markerDetected) {
                    markerDetected = false;
                    log('„Éû„Éº„Ç´„Éº„É≠„Çπ„Éà');
                    
                    markerGuide.classList.remove('detected');
                    document.getElementById('marker-status').textContent = 'Êé¢Á¥¢‰∏≠';
                    document.getElementById('marker-status').style.color = '#FFD700';
                    
                    infoText.innerHTML = `
                        <div style="font-size: 14px;">„Éû„Éº„Ç´„Éº„ÇíÊé¢„Åó„Å¶„ÅÑ„Åæ„Åô...</div>
                        <div style="font-size: 12px; margin-top: 5px; color: #888;">„Ç¨„Ç§„ÉâÊû†ÂÜÖ„Å´„Éû„Éº„Ç´„Éº„ÇíÈÖçÁΩÆ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                    `;
                    
                    info.style.borderColor = '#4CAF50';
                    info.style.boxShadow = 'none';
                    
                    // Ë™çË≠òÂº∑Â∫¶„ÇíÊÆµÈöéÁöÑ„Å´‰∏ã„Åí„Çã
                    let confidence = detectionConfidence;
                    const decreaseConfidence = setInterval(() => {
                        confidence -= 20;
                        updateConfidence(confidence);
                        if (confidence <= 0) {
                            clearInterval(decreaseConfidence);
                        }
                    }, 100);
                }
            });
            
            // „Ç∑„Éº„É≥„Ç§„Éô„É≥„Éà
            if (scene) {
                scene.addEventListener('arjs-video-loaded', () => {
                    log('AR.js„Éì„Éá„Ç™Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü', 'success');
                });
                
                scene.addEventListener('camera-init', () => {
                    log('AR„Ç´„É°„É©ÂàùÊúüÂåñÂÆå‰∫Ü', 'success');
                });
            }
        }
        
        // ARÂãï‰ΩúÁä∂ÊÖã„ÉÅ„Çß„ÉÉ„ÇØ
        function checkARHealth() {
            const video = document.querySelector('#arjs-video') || document.querySelector('video');
            const canvas = document.querySelector('.a-canvas');
            
            if (video && video.readyState >= 2) {
                document.getElementById('camera-status').textContent = 'Ê≠£Â∏∏';
                document.getElementById('camera-status').style.color = '#00FF00';
            } else {
                document.getElementById('camera-status').textContent = 'Á¢∫Ë™ç‰∏≠';
                document.getElementById('camera-status').style.color = '#FFD700';
            }
            
            // „Éû„Éº„Ç´„ÉºÊú™Ê§úÂá∫„ÅåÁ∂ö„ÅèÂ†¥Âêà„ÅÆ„Éí„É≥„ÉàË°®Á§∫
            if (!markerDetected && detectionConfidence === 0) {
                const hints = [
                    "Êòé„Çã„ÅÑÂ†¥ÊâÄ„Å´ÁßªÂãï„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ",
                    "„Éû„Éº„Ç´„Éº„Å®„ÅÆË∑ùÈõ¢„Çí20-40cm„Å´Ë™øÊï¥",
                    "„Éû„Éº„Ç´„Éº„ÅåÂπ≥„Çâ„Å´„Å™„Å£„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç",
                    "„Ç´„É°„É©„É¨„É≥„Ç∫„ÅåÊ±ö„Çå„Å¶„ÅÑ„Å™„ÅÑ„ÅãÁ¢∫Ë™ç",
                    "„Éû„Éº„Ç´„Éº„ÅÆÂç∞Âà∑ÂìÅË≥™„ÇíÁ¢∫Ë™ç"
                ];
                const randomHint = hints[Math.floor(Math.random() * hints.length)];
                document.getElementById('guide-text').textContent = `üí° ${randomHint}`;
            }
        }
        
        // „Ç´„É°„É©„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
        function handleCameraError(error) {
            let errorMessage = "";
            let solution = "";
            
            switch (error.name) {
                case 'NotAllowedError':
                    errorMessage = "„Ç´„É°„É©„ÅÆË®±ÂèØ„ÅåÊãíÂê¶„Åï„Çå„Åæ„Åó„Åü";
                    solution = "„Éñ„É©„Ç¶„Ç∂Ë®≠ÂÆö„Åß„Ç´„É°„É©„ÇíË®±ÂèØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ";
                    break;
                case 'NotFoundError':
                    errorMessage = "„Ç´„É°„É©„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì";
                    solution = "„Éá„Éê„Ç§„Çπ„Å´„Ç´„É°„É©„ÅåÊé•Á∂ö„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ";
                    break;
                case 'NotSupportedError':
                case 'TypeError':
                    errorMessage = "„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØ„Çµ„Éù„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì";
                    solution = "Chrome„ÄÅFirefox„ÄÅ„Åæ„Åü„ÅØSafari„Çí„Åä‰Ωø„ÅÑ„Åè„Å†„Åï„ÅÑ";
                    break;
                default:
                    errorMessage = "„Ç´„É°„É©„ÅÆËµ∑Âãï„Å´Â§±Êïó„Åó„Åæ„Åó„Åü";
                    solution = "„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ";
            }
            
            status.innerHTML = `
                <div style="color: #FF4444; font-size: 18px; margin-bottom: 10px;">‚ö†Ô∏è ${errorMessage}</div>
                <div style="font-size: 14px; margin-bottom: 15px; color: #CCC;">${solution}</div>
                <button onclick="location.reload()" 
                        style="padding: 12px 24px; background: #4CAF50; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer;">
                    üîÑ ÂÜçË™≠„ÅøËæº„Åø
                </button>
            `;
        }
        
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂàùÊúüÂåñ
        window.addEventListener('load', () => {
            log(`„Éá„Éê„Ç§„Çπ: ${isMobile ? (isIOS ? 'iOS' : 'Android') : 'Desktop'}`);
            log(`„Éñ„É©„Ç¶„Ç∂: ${navigator.userAgent.substring(0, 50)}...`);
            
            // HTTPSÁ¢∫Ë™ç
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                log('‚ö†Ô∏è HTTPS„ÅåÂøÖË¶Å„Åß„Åô', 'error');
                status.innerHTML = `
                    <div style="color: #FF4444;">„Çª„Ç≠„É•„Ç¢„Å™Êé•Á∂öÔºàHTTPSÔºâ„ÅåÂøÖË¶Å„Åß„Åô</div>
                `;
            }
            
            // WebRTCÂØæÂøúÁ¢∫Ë™ç
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                log('WebRTCÈùûÂØæÂøú', 'error');
                status.innerHTML = `
                    <div style="color: #FF4444;">„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØ„Ç´„É°„É©Ê©üËÉΩ„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì</div>
                `;
            }
        });
    </script>
</body>
</html>


