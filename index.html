<!DOCTYPE html>
<HTML lung="JA">
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no">
    <title>AR Stamp Rally - Enhanced</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #000;
            overflow: hidden;
        }
        
        #arjs-video {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            object-fit: cover !important;
            z-index: -1 !important;
        }
        
        .a-canvas {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            z-index: 1 !important;
        }
        
        #ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 999;
            pointer-events: none;
        }
        
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            pointer-events: all;
        }
        
        #startButton {
            background: #4CAF50;
            border: none;
            color: white;
            padding: 20px 40px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 18px;
            margin: 20px 2px;
            cursor: pointer;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            touch-action: manipulation;
        }
        
        #info {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            text-align: center;
            pointer-events: none;
            border: 2px solid #4CAF50;
        }
        
        #stats {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: #00FF00;
            padding: 10px;
            border-radius: 5px;
            font-size: 11px;
            font-family: monospace;
            pointer-events: none;
            min-width: 200px;
            border: 1px solid #00FF00;
        }
        
        #debug {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: #FFD700;
            padding: 10px;
            border-radius: 5px;
            font-size: 11px;
            font-family: monospace;
            pointer-events: none;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #FFD700;
        }
        
        #marker-guide {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 250px;
            pointer-events: none;
            z-index: 100;
        }
        
        .corner {
            position: absolute;
            width: 40px;
            height: 40px;
            border: 3px solid #4CAF50;
        }
        
        .corner-tl {
            top: 0;
            left: 0;
            border-right: none;
            border-bottom: none;
        }
        
        .corner-tr {
            top: 0;
            right: 0;
            border-left: none;
            border-bottom: none;
        }
        
        .corner-bl {
            bottom: 0;
            left: 0;
            border-right: none;
            border-top: none;
        }
        
        .corner-br {
            bottom: 0;
            right: 0;
            border-left: none;
            border-top: none;
        }
        
        #marker-guide.detected {
            animation: pulse 0.5s;
        }
        
        #marker-guide.detected .corner {
            border-color: #00FF00;
            box-shadow: 0 0 10px #00FF00;
        }
        
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        #guide-text {
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            color: #4CAF50;
            font-size: 12px;
            background: rgba(0,0,0,0.9);
            padding: 5px 10px;
            border-radius: 5px;
            white-space: nowrap;
        }
        
        .hidden {
            display: none !important;
        }
        
        #confidence-bar {
            position: fixed;
            bottom: 180px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 20px;
            background: rgba(0,0,0,0.8);
            border: 1px solid #444;
            border-radius: 10px;
            overflow: hidden;
        }
        
        #confidence-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #FF0000, #FFD700, #00FF00);
            transition: width 0.3s ease;
        }
        
        #confidence-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="ui-overlay">
        <div id="loading">
            <h1>ğŸ¯ AR ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</h1>
            <p id="status">ã‚¿ãƒƒãƒ—ã—ã¦é–‹å§‹</p>
            <button id="startButton">ğŸ“· ã‚«ãƒ¡ãƒ©ã‚’é–‹å§‹</button>
            <div style="margin-top: 20px; font-size: 14px; opacity: 0.8; max-width: 300px;">
                <p style="color: #FFD700;">ğŸ“Œ é‡è¦ãªæº–å‚™ï¼š</p>
                <ul style="text-align: left; color: #CCC;">
                    <li>HIROãƒãƒ¼ã‚«ãƒ¼ã‚’å°åˆ·ã¾ãŸã¯ç”»é¢è¡¨ç¤º</li>
                    <li>æ˜ã‚‹ã„å ´æ‰€ã§ä½¿ç”¨</li>
                    <li>ãƒãƒ¼ã‚«ãƒ¼ã‚’å¹³ã‚‰ã«ç½®ã</li>
                    <li>ã‚«ãƒ¡ãƒ©ã‹ã‚‰20-40cmã®è·é›¢</li>
                </ul>
                <a href="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png" 
                   target="_blank" 
                   style="color: #4CAF50; text-decoration: none; display: inline-block; margin-top: 10px; padding: 8px 16px; border: 1px solid #4CAF50; border-radius: 5px;">
                    ğŸ“¥ HIROãƒãƒ¼ã‚«ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                </a>
            </div>
        </div>
        
        <div id="info" class="hidden">
            <div id="info-text">ARã‚«ãƒ¡ãƒ©èµ·å‹•ä¸­...</div>
        </div>
        
        <div id="stats" class="hidden">
            <div style="color: white; font-weight: bold; margin-bottom: 5px;">ğŸ“Š èªè­˜çŠ¶æ…‹</div>
            <div id="stats-content">
                FPS: <span id="fps">0</span><br>
                æ¤œå‡ºå¼·åº¦: <span id="detection">0</span>%<br>
                ãƒãƒ¼ã‚«ãƒ¼çŠ¶æ…‹: <span id="marker-status">æ¢ç´¢ä¸­</span><br>
                ã‚«ãƒ¡ãƒ©: <span id="camera-status">æº–å‚™ä¸­</span>
            </div>
        </div>
        
        <div id="marker-guide" class="hidden">
            <div id="guide-text">HIROãƒãƒ¼ã‚«ãƒ¼ã‚’ã“ã“ã«åˆã‚ã›ã‚‹</div>
            <div class="corner corner-tl"></div>
            <div class="corner corner-tr"></div>
            <div class="corner corner-bl"></div>
            <div class="corner corner-br"></div>
        </div>
        
        <div id="confidence-bar" class="hidden">
            <div id="confidence-fill"></div>
            <div id="confidence-label">èªè­˜å¼·åº¦: 0%</div>
        </div>
        
        <div id="debug" class="hidden">
            <div id="debug-text">Debug info</div>
        </div>
    </div>

    <!-- æœ€é©åŒ–ã•ã‚ŒãŸAR Scene -->
    <a-scene
        id="arScene"
        embedded
        arjs="sourceType: webcam; 
              debugUIEnabled: false; 
              detectionMode: mono; 
              matrixCodeType: 3x3;
              trackingMethod: best;
              patternRatio: 0.5;
              labelingMode: black_region;
              processingMode: best;
              maxDetectionRate: 60;
              canvasWidth: 640;
              canvasHeight: 480;
              imageSmoothingEnabled: true;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false"
        renderer="logarithmicDepthBuffer: true; 
                  precision: high; 
                  antialias: true; 
                  alpha: true;
                  colorManagement: true;"
        stats>
        
        <!-- ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ¡ãƒ©è¨­å®š -->
        <a-camera-static/>
        
        <!-- æœ€é©åŒ–ã•ã‚ŒãŸHIROãƒãƒ¼ã‚«ãƒ¼ -->
        <a-marker
            preset="hiro"
            id="hiro-marker"
            smooth="true"
            smoothCount="10"
            smoothTolerance="0.01"
            smoothThreshold="5"
            size="1"
            type="pattern"
            url="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/data/patt.hiro">
            
            <!-- ãƒ¡ã‚¤ãƒ³ã®ã‚¹ã‚¿ãƒ³ãƒ—ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ -->
            <a-entity id="stamp-container" position="0 0 0">
                
                <!-- ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  -->
                <a-cylinder
                    position="0 0 0"
                    radius="1"
                    height="0.1"
                    color="#2C3E50"
                    shadow="receive: true">
                </a-cylinder>
                
                <!-- ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ãƒ— -->
                <a-box
                    id="main-stamp"
                    position="0 0.5 0"
                    scale="0.6 0.6 0.6"
                    material="color: #FFD700; metalness: 0.3; roughness: 0.4"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 3000; easing: easeInOutQuad"
                    shadow>
                </a-box>
                
                <!-- è£…é£¾ãƒªãƒ³ã‚°1 -->
                <a-torus
                    position="0 0.5 0"
                    color="#FF6B6B"
                    radius="0.7"
                    radius-tubular="0.05"
                    animation="property: rotation; to: 360 0 0; loop: true; dur: 2000">
                </a-torus>
                
                <!-- è£…é£¾ãƒªãƒ³ã‚°2 -->
                <a-torus
                    position="0 0.5 0"
                    color="#4ECDC4"
                    radius="0.9"
                    radius-tubular="0.03"
                    animation="property: rotation; to: 0 360 360; loop: true; dur: 3000">
                </a-torus>
                
                <!-- ã‚¹ã‚¿ãƒ³ãƒ—ãƒ†ã‚­ã‚¹ãƒˆ -->
                <a-text
                    value="STAMP GET!"
                    position="0 1.3 0"
                    align="center"
                    color="#FFFFFF"
                    font="kelsonsans"
                    width="4"
                    animation="property: scale; from: 1 1 1; to: 1.2 1.2 1.2; dir: alternate; loop: true; dur: 1000">
                </a-text>
                
                <!-- ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœ -->
                <a-entity
                    position="0 0.5 0"
                    particle-system="preset: star; 
                                   particleCount: 100; 
                                   color: #FFD700,#FF6B6B; 
                                   size: 0.5; 
                                   duration: 0.1;
                                   accelerationValue: 0,-5,0;
                                   velocityValue: 0,3,0">
                </a-entity>
                
            </a-entity>
            
        </a-marker>
        
        <a-entity camera></a-entity>
        
    </a-scene>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        const startButton = document.getElementById('startButton');
        const loading = document.getElementById('loading');
        const info = document.getElementById('info');
        const status = document.getElementById('status');
        const infoText = document.getElementById('info-text');
        const debug = document.getElementById('debug');
        const debugText = document.getElementById('debug-text');
        const stats = document.getElementById('stats');
        const markerGuide = document.getElementById('marker-guide');
        const confidenceBar = document.getElementById('confidence-bar');
        const confidenceFill = document.getElementById('confidence-fill');
        const confidenceLabel = document.getElementById('confidence-label');
        
        let debugLog = [];
        let markerDetected = false;
        let detectionConfidence = 0;
        let frameCount = 0;
        let lastTime = performance.now();
        let fps = 0;
        
        // ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡º
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const isAndroid = /Android/.test(navigator.userAgent);
        const isMobile = isIOS || isAndroid;
        
        // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°é–¢æ•°
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'ğŸ“';
            const logEntry = `${timestamp} ${icon} ${message}`;
            
            console.log(logEntry);
            debugLog.push(logEntry);
            if (debugLog.length > 8) debugLog.shift();
            
            debugText.innerHTML = debugLog.join('<br>');
            debug.classList.remove('hidden');
        }
        
        // FPSè¨ˆç®—
        function updateFPS() {
            frameCount++;
            const currentTime = performance.now();
            if (currentTime >= lastTime + 1000) {
                fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                document.getElementById('fps').textContent = fps;
                frameCount = 0;
                lastTime = currentTime;
            }
            requestAnimationFrame(updateFPS);
        }
        
        // èªè­˜å¼·åº¦ã®æ›´æ–°
        function updateConfidence(value) {
            detectionConfidence = Math.min(100, Math.max(0, value));
            confidenceFill.style.width = detectionConfidence + '%';
            confidenceLabel.textContent = `èªè­˜å¼·åº¦: ${Math.round(detectionConfidence)}%`;
            document.getElementById('detection').textContent = Math.round(detectionConfidence);
        }
        
        // ã‚«ãƒ¡ãƒ©é–‹å§‹å‡¦ç†
        startButton.addEventListener('click', async function() {
            log('ã‚«ãƒ¡ãƒ©èµ·å‹•é–‹å§‹');
            status.textContent = "ã‚«ãƒ¡ãƒ©ã«ã‚¢ã‚¯ã‚»ã‚¹ä¸­...";
            
            try {
                // ã‚«ãƒ¡ãƒ©ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’å–å¾—
                const constraints = {
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1280, max: 1920 },
                        height: { ideal: 720, max: 1080 },
                        frameRate: { ideal: 30, max: 60 }
                    }
                };
                
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                log('ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹æˆåŠŸ', 'success');
                
                // ã‚¹ãƒˆãƒªãƒ¼ãƒ æƒ…å ±ã‚’ãƒ­ã‚°
                const track = stream.getVideoTracks()[0];
                const settings = track.getSettings();
                log(`è§£åƒåº¦: ${settings.width}x${settings.height} @ ${settings.frameRate}fps`);
                
                // AR.jsã«ä»»ã›ã‚‹ãŸã‚ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’åœæ­¢
                stream.getTracks().forEach(track => track.stop());
                
                // UIåˆ‡ã‚Šæ›¿ãˆ
                setTimeout(() => {
                    loading.classList.add('hidden');
                    info.classList.remove('hidden');
                    stats.classList.remove('hidden');
                    markerGuide.classList.remove('hidden');
                    confidenceBar.classList.remove('hidden');
                    
                    infoText.innerHTML = `
                        <div style="font-size: 16px; color: #4CAF50;">âœ¨ ARã‚«ãƒ¡ãƒ©èµ·å‹•å®Œäº†</div>
                        <div style="font-size: 12px; margin-top: 5px;">HIROãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚¬ã‚¤ãƒ‰æ å†…ã«é…ç½®ã—ã¦ãã ã•ã„</div>
                    `;
                    
                    document.getElementById('camera-status').textContent = 'å‹•ä½œä¸­';
                    document.getElementById('camera-status').style.color = '#00FF00';
                    
                    // AR.jsã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
                    setupARListeners();
                    
                    // FPSè¨ˆæ¸¬é–‹å§‹
                    updateFPS();
                    
                    // å®šæœŸçš„ãªçŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
                    setInterval(checkARHealth, 2000);
                    
                }, isMobile ? 3000 : 2000);
                
            } catch (error) {
                log(`ã‚«ãƒ¡ãƒ©ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                handleCameraError(error);
            }
        });
        
        // ARã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        function setupARListeners() {
            const marker = document.getElementById('hiro-marker');
            const scene = document.querySelector('a-scene');
            
            if (!marker) {
                log('ãƒãƒ¼ã‚«ãƒ¼è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            // ãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºã‚¤ãƒ™ãƒ³ãƒˆ
            marker.addEventListener('markerFound', () => {
                if (!markerDetected) {
                    markerDetected = true;
                    log('HIROãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºï¼', 'success');
                    
                    markerGuide.classList.add('detected');
                    document.getElementById('marker-status').textContent = 'æ¤œå‡ºä¸­';
                    document.getElementById('marker-status').style.color = '#00FF00';
                    
                    infoText.innerHTML = `
                        <div style="font-size: 18px; color: #00FF00;">ğŸ‰ ã‚¹ã‚¿ãƒ³ãƒ—ç™ºè¦‹ï¼</div>
                        <div style="font-size: 12px; margin-top: 5px;">ãƒãƒ¼ã‚«ãƒ¼ã‚’å®‰å®šã•ã›ã¦ãã ã•ã„</div>
                    `;
                    
                    info.style.borderColor = '#00FF00';
                    info.style.boxShadow = '0 0 20px #00FF00';
                    
                    // èªè­˜å¼·åº¦ã‚’æ®µéšçš„ã«ä¸Šã’ã‚‹
                    let confidence = 0;
                    const increaseConfidence = setInterval(() => {
                        confidence += 10;
                        updateConfidence(confidence);
                        if (confidence >= 100) {
                            clearInterval(increaseConfidence);
                        }
                    }, 100);
                }
            });
            
            // ãƒãƒ¼ã‚«ãƒ¼ãƒ­ã‚¹ãƒˆã‚¤ãƒ™ãƒ³ãƒˆ
            marker.addEventListener('markerLost', () => {
                if (markerDetected) {
                    markerDetected = false;
                    log('ãƒãƒ¼ã‚«ãƒ¼ãƒ­ã‚¹ãƒˆ');
                    
                    markerGuide.classList.remove('detected');
                    document.getElementById('marker-status').textContent = 'æ¢ç´¢ä¸­';
                    document.getElementById('marker-status').style.color = '#FFD700';
                    
                    infoText.innerHTML = `
                        <div style="font-size: 14px;">ãƒãƒ¼ã‚«ãƒ¼ã‚’æ¢ã—ã¦ã„ã¾ã™...</div>
                        <div style="font-size: 12px; margin-top: 5px; color: #888;">ã‚¬ã‚¤ãƒ‰æ å†…ã«ãƒãƒ¼ã‚«ãƒ¼ã‚’é…ç½®ã—ã¦ãã ã•ã„</div>
                    `;
                    
                    info.style.borderColor = '#4CAF50';
                    info.style.boxShadow = 'none';
                    
                    // èªè­˜å¼·åº¦ã‚’æ®µéšçš„ã«ä¸‹ã’ã‚‹
                    let confidence = detectionConfidence;
                    const decreaseConfidence = setInterval(() => {
                        confidence -= 20;
                        updateConfidence(confidence);
                        if (confidence <= 0) {
                            clearInterval(decreaseConfidence);
                        }
                    }, 100);
                }
            });
            
            // ã‚·ãƒ¼ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
            if (scene) {
                scene.addEventListener('arjs-video-loaded', () => {
                    log('AR.jsãƒ“ãƒ‡ã‚ªèª­ã¿è¾¼ã¿å®Œäº†', 'success');
                });
                
                scene.addEventListener('camera-init', () => {
                    log('ARã‚«ãƒ¡ãƒ©åˆæœŸåŒ–å®Œäº†', 'success');
                });
            }
        }
        
        // ARå‹•ä½œçŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
        function checkARHealth() {
            const video = document.querySelector('#arjs-video') || document.querySelector('video');
            const canvas = document.querySelector('.a-canvas');
            
            if (video && video.readyState >= 2) {
                document.getElementById('camera-status').textContent = 'æ­£å¸¸';
                document.getElementById('camera-status').style.color = '#00FF00';
            } else {
                document.getElementById('camera-status').textContent = 'ç¢ºèªä¸­';
                document.getElementById('camera-status').style.color = '#FFD700';
            }
            
            // ãƒãƒ¼ã‚«ãƒ¼æœªæ¤œå‡ºãŒç¶šãå ´åˆã®ãƒ’ãƒ³ãƒˆè¡¨ç¤º
            if (!markerDetected && detectionConfidence === 0) {
                const hints = [
                    "æ˜ã‚‹ã„å ´æ‰€ã«ç§»å‹•ã—ã¦ã¿ã¦ãã ã•ã„",
                    "ãƒãƒ¼ã‚«ãƒ¼ã¨ã®è·é›¢ã‚’20-40cmã«èª¿æ•´",
                    "ãƒãƒ¼ã‚«ãƒ¼ãŒå¹³ã‚‰ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª",
                    "ã‚«ãƒ¡ãƒ©ãƒ¬ãƒ³ã‚ºãŒæ±šã‚Œã¦ã„ãªã„ã‹ç¢ºèª",
                    "ãƒãƒ¼ã‚«ãƒ¼ã®å°åˆ·å“è³ªã‚’ç¢ºèª"
                ];
                const randomHint = hints[Math.floor(Math.random() * hints.length)];
                document.getElementById('guide-text').textContent = `ğŸ’¡ ${randomHint}`;
            }
        }
        
        // ã‚«ãƒ¡ãƒ©ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        function handleCameraError(error) {
            let errorMessage = "";
            let solution = "";
            
            switch (error.name) {
                case 'NotAllowedError':
                    errorMessage = "ã‚«ãƒ¡ãƒ©ã®è¨±å¯ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ";
                    solution = "ãƒ–ãƒ©ã‚¦ã‚¶è¨­å®šã§ã‚«ãƒ¡ãƒ©ã‚’è¨±å¯ã—ã¦ãã ã•ã„";
                    break;
                case 'NotFoundError':
                    errorMessage = "ã‚«ãƒ¡ãƒ©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“";
                    solution = "ãƒ‡ãƒã‚¤ã‚¹ã«ã‚«ãƒ¡ãƒ©ãŒæ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„";
                    break;
                case 'NotSupportedError':
                case 'TypeError':
                    errorMessage = "ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“";
                    solution = "Chromeã€Firefoxã€ã¾ãŸã¯Safariã‚’ãŠä½¿ã„ãã ã•ã„";
                    break;
                default:
                    errorMessage = "ã‚«ãƒ¡ãƒ©ã®èµ·å‹•ã«å¤±æ•—ã—ã¾ã—ãŸ";
                    solution = "ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãŠè©¦ã—ãã ã•ã„";
            }
            
            status.innerHTML = `
                <div style="color: #FF4444; font-size: 18px; margin-bottom: 10px;">âš ï¸ ${errorMessage}</div>
                <div style="font-size: 14px; margin-bottom: 15px; color: #CCC;">${solution}</div>
                <button onclick="location.reload()" 
                        style="padding: 12px 24px; background: #4CAF50; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer;">
                    ğŸ”„ å†èª­ã¿è¾¼ã¿
                </button>
            `;
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.addEventListener('load', () => {
            log(`ãƒ‡ãƒã‚¤ã‚¹: ${isMobile ? (isIOS ? 'iOS' : 'Android') : 'Desktop'}`);
            log(`ãƒ–ãƒ©ã‚¦ã‚¶: ${navigator.userAgent.substring(0, 50)}...`);
            
            // HTTPSç¢ºèª
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                log('âš ï¸ HTTPSãŒå¿…è¦ã§ã™', 'error');
                status.innerHTML = `
                    <div style="color: #FF4444;">ã‚»ã‚­ãƒ¥ã‚¢ãªæ¥ç¶šï¼ˆHTTPSï¼‰ãŒå¿…è¦ã§ã™</div>
                `;
            }
            
            // WebRTCå¯¾å¿œç¢ºèª
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                log('WebRTCéå¯¾å¿œ', 'error');
                status.innerHTML = `
                    <div style="color: #FF4444;">ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ã‚«ãƒ¡ãƒ©æ©Ÿèƒ½ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“</div>
                `;
            }
        });
    </script>
</body>
</html>


